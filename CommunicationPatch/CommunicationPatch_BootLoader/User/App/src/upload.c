/*******************************************************************************
// Copyright(c)2017, 天津新众聚联信息科技股份有限公司
// All rights reserved.
// Version: v1.0 
// Device : STM32F103VCT6
// Built  : IAR For ARM v7.40(Language：C)
// Date   : 2017-04-01
// Author : 刘锋
// Functiom: 从单片机上传文件到PC机的源文件
*******************************************************************************/  

/******************************************************************************
//包含头文件
*******************************************************************************/
#include "includes.h"


/******************************************************************************
//变量定义
*******************************************************************************/





/******************************************************************************
//函数声明
*******************************************************************************/



/******************************************************************************
//函数定义
*******************************************************************************/
//********************************************************
//函数名称: main
//函数功能: 通过串口上传一个镜像函数
//输    入: 无
//输    出: 无
//备    注: 
//********************************************************
void SerialUpload(void)
{
    uint32_t status = 0; 

    SerialPutString("\n\n\r选择接收文件 ... (按下任意键取消)\n\r");

    if (GetKey() == CRC16)
    {
        //通过ymodem协议上传闪存FLASH镜像
        status = Ymodem_Transmit((uint8_t*)ApplicationAddress, (const uint8_t*)"L2000_UploadedFlashImage.bin", FLASH_IMAGE_SIZE);
        if (status != 0) 
        {
            //上传失败
            SerialPutString("\n\r上传失败！\n\r");
        }
        else
        {
            //上传成功
            SerialPutString("\n\r上传成功\n\r");
        }//end of if (status != 0) 
    }
    else
    {
        SerialPutString("\r\n\n用户取消上传！\n\r");  
    }//end of if (GetKey() == CRC16)
}


//////////////////////////////END OF C文件////////////////////////////////////
