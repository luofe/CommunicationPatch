/*******************************************************************************
//Copyright(C)2018 , 蛙鸣公司
// All rights reserved.
// Version: v1.0 
// Device : STM32F103C8T6
// Built  : IAR For ARM v7.70(Language: C)
// Date   : 2018-10-27
// Author : 刘锋
// Functiom:APP应用程序的工程说明文档，记录程序进度
*******************************************************************************/


20181116:
1、解决了传感器数据上报不能显示在网页的问题，原因是传感器个数错误；


20181112:
1、完成了启动时读取设备编号和GPS信息的程序；
2、完成了启动时读取心跳包和通用数据上报间隔；
3、增加了启动时读取电池电压的程序，待验证；


20181111:
1、完成发送、接收及处理与设备端通信的程序，能发送控制显示若干打印、重启、传感器数据接收解析等功能；


20181110:
1、完成接收服务器数据包的解析及处理程序，能发送握手包给服务器，而且能正常接收、处理服务器发来的时间同步和通用应答包；

20181108:
1、完成无线模块所有的AT指令操作程序，待验证、测试和修改；

20181106:
1、开始编写无线模块的AT指令操作程序；


20181103:
1、开始编写与服务器通信的程序；


20181028:
1、完成DEBUG口的通信程序；


20181027:
1、建立工程；
//////////////////////////////////////////////////////////////////////
与设备端通信的工作流程：
1、上电复位一次设备；
2、等待接收设备端打印的各个传感器状态信息；
3、等待接收传感器采集开始的打印信息（表示启动完毕）；
4、打开GPS打印信息，得到后关闭；
5、间隔若干时间打开传感器信息打印，即"$SHOW_DATA"，得到后关闭
6、




设备重启后打印：
[RTC]: Software reset occurred....

[RTC]: No need to configure RTC....

------<SYSTEM START>-----
[Init]: FLASH......(ok)!
[Init]: GAS........(ok)(4)!
[Init]: RS485......(ok)!
[Init]: WK2114.....(ok)!
[Init]: ADS1248....(ok)!
[Init]: NET........(ok)!
[Init]: GSM........(checking)!
[Init]: TRH........(ok)(1)!
[Init]: GPS........(ok)!
[Init]: Weather....(ok)!
[Init]: PM2.5......(ok)!
[Init]: CO2........(error)!
[EVENT]: Sampling start!


Q_ID=80003165
Q_DATARPT=60,300(OK!)
Q_HEALTHRPT=180(OK!)

[ADC]: VBat=2759/1522V

/*
******************************************************************************
* Function Name  : SSInfoPrint()
* Description    : 传感器信息输出格式
* Input          : 
* Output         : None
* Return         : None
//左对齐输出
******************************************************************************
*/
static	void	SSInfoPrint (void)
{
[SS-Temp  ]=2236
[SS-RH    ]=7075
[SS-PM2.5 ]=9000,3006,5039
[SS-PM10  ]=12000,7120,12104
[SS-CO(3) ]=54183,3010342,1270803
[SS-NO2(4)]=1846,4702,80053
[SS-O3(5) ]=13190,-56089,104090
[SS-SO2(6)]=167870,264521,4639
[SS-NO(7) ]=0,0,0
[SS-Temp-W]=2480
[SS-RH-W  ]=6240
[SS-WD    ]=20700
[SS-WS    ]=0
[SS-PA    ]=101950
[FUN-main ]=0/min
[FUN-pm10 ]=0/min
2018-9-28	4:39:22	
}

/*
******************************************************************************
* Function Name  : GPSInfoPrint()
* Description    : GPS信息输出
* Input          : 
* Output         : None
* Return         : None
//左对齐
******************************************************************************
*/
static	void	GPSInfoPrint (void)
{
$GPGGA,235947.020,,,,,0,0,,,M,,M,,*44
$GPGLL,,,,,235947.020,V,N*76
$GPGSA,A,1,,,,,,,,,,,,,,,*1E
$GPGSV,1,1,00*79
$GPRMC,235947.020,V,,,,,0.00,0.00,050180,,,N*4D
$GPVTG,0.00,T,,M,0.00,N,0.00,K,N*32			
}




//////////////////////////////////////////////////////////////////////
// 系统应用参数区-默认参数定义
#define	DEF_DFT_SYSCFG_SAVED_MARK			((u16)0x66AA)				// 系统应用参数区初始化完成标志((默0x66AA,修改后参数将复位)
#define	DEF_DFT_SYSCFG_SUM						((u16)0x0000)			// 需要根据具体参数计算!!!!
#define	DEF_DFT_SYSCFG_AESTYPE				((u8)0x00)					// 加密类型	
#define	DEF_DFT_SYSCFG_AESKEY					("")					// 秘钥
#define	DEF_DFT_SYSCFG_APN						("")					// 系统APN	
#define	DEF_DFT_SYSCFG_APNUSER				("")						// 系统APN登陆用户	
#define	DEF_DFT_SYSCFG_APNPASS				("")						// 系统APN登陆密码	
#define	DEF_DFT_SYSCFG_DOMAINEN				((u8)0)                     // 域名连接使能如果为1则使能域名连接为0则禁止域名连接即IP连接
#define	DEF_DFT_SYSCFG_DNSIP					("202.106.0.20")		// 系统域名服务器IP地址
#define	DEF_DFT_SYSCFG_DOMAIN1				("null1")					// 系统域名1
#define	DEF_DFT_SYSCFG_DOMAIN2				("null2")					// 系统域名2
#define	DEF_DFT_SYSCFG_IP1						("58.83.189.147")		// 系统主服务器IP地址(主IP)
#define	DEF_DFT_SYSCFG_PORT1					("21009")				// 系统主服务器端口号
#define	DEF_DFT_SYSCFG_IP2						("58.83.189.147")		// 系统辅助服务器IP地址(辅助IP)
#define	DEF_DFT_SYSCFG_PORT2					("21009")				// 系统辅助服务器端口号
#define	DEF_DFT_SYSCFG_NATIONCODE			("86")						// 国家代码(中国默认"86")使用PDU方式发送短信时使用		
#define	DEF_DFT_SYSCFG_SMSCENTER			("")						// 监控平台SMS猫电话号码	



以下功能为必须实现功能。
?	支持传感器远程校准（k1、b1等）。
?	支持数据上传。
?	支持GPS定位。
?	握手指令（0x80）。
?	设置和查询系统RTC时间。
?	设置IP地址。
?	设置和查询通用数据上传间隔。
?	设置和查询健康包上传时间间隔。
?	设备复位指令。








//////////////////////////////C文件/////////////////////////////////////
/*******************************************************************************
//XXX.c
//XXX驱动文件
*******************************************************************************/

/******************************************************************************
//包含头文件
*******************************************************************************/
#include "stm32l1xx.h"
#include "system_stm32l1xx.h"
#include "stm32l1xx_conf.h"
#include "XXX/XXX.h"

/******************************************************************************
//变量定义
*******************************************************************************/


/******************************************************************************
//函数定义
*******************************************************************************/



//////////////////////////////END OF C文件////////////////////////////////////


//////////////////////////////头文件/////////////////////////////////////
/*******************************************************************************
//XXX.h
//XXX驱动头文件
*******************************************************************************/

#ifndef	XXX_H
#define	XXX_H

/******************************************************************************
//宏定义
*******************************************************************************/

